<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Methods ‚Ä¢ NWCTrends</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="48x48" href="../favicon-48x48.png">
<link rel="icon" type="‚Äùimage/svg+xml‚Äù" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Methods">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">NWCTrends</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.31</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    News

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Releases</li>
    <li>
      <a href="https://github.com/nwfsc-math-bio/NWCTrends/releases/tag/v1.0" class="external-link">Version 1.0 2015 VR</a>
    </li>
    <li>
      <a href="https://github.com/nwfsc-math-bio/NWCTrends/releases/tag/v1.25" class="external-link">Version 1.25 2020 VR</a>
    </li>
    <li>
      <a href="https://github.com/nwfsc-math-bio/NWCTrends/releases/tag/v1.30" class="external-link">Version 1.30</a>
    </li>
    <li class="divider">
    </li>
<li>
      <a href="../news/index.html">Changelog</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Viability PDFs

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://github.com/nwfsc-math-bio/NWCTrends/raw/master/reports/2015_Status_Review_noaa_17015_DS1.pdf" class="external-link">Viability Report 2015 (PDF)</a>
    </li>
    <li>
      <a href="https://github.com/nwfsc-math-bio/NWCTrends/raw/master/reports/2020_Viability_Report.pdf" class="external-link">Viability Report 2020 (PDF)</a>
    </li>
    <li>
      <a href="https://github.com/nwfsc-math-bio/NWCTrends/raw/master/reports/Methods.pdf" class="external-link">Methods (PDF)</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/nwfsc-math-bio/NWCTrends/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Methods</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/nwfsc-math-bio/NWCTrends/blob/HEAD/vignettes/Methods.Rmd" class="external-link"><code>vignettes/Methods.Rmd</code></a></small>
      <div class="hidden name"><code>Methods.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="common-metrics-for-esus">Common metrics for ESUs<a class="anchor" aria-label="anchor" href="#common-metrics-for-esus"></a>
</h2>
<p>Multivariate dynamic linear modeling (DLM) was used to estimate
population specific mean trends in each ESU from the log of total
spawner counts. The result is an estimate of the mean or smoothed total
spawner counts, from which summary statistics regarding trends were
computed. In addition, a univariate DLM was applied to the logit of the
fraction wild estimate to produce a smoothed fraction wild time series.
This was used to produce an estimate of the mean wild spawners (for
years when fraction wild estimates were available).</p>
<p>The mean or smoothed total spawner count is similar (in concept) to a
3- or 5-year geometric mean; the goal is the same‚Äîto produce an estimate
that smooths over single year variation. The multivariate DLM approach
has a number of advantages. Most importantly it is a statistical model
for which maximum-likelihood diagnostics, model selection criteria, and
confidence intervals are available. It is a time-series model, which
addresses temporal autocorrelation in the data. It deals with missing
data and provides an estimate for the missing year with appropriately
wider confidence intervals. And lastly, it allows us to use information
across all populations within an ESU to estimate the level of
year-to-year trend variation‚Äîthe process variance‚Äîand allows us to
estimate the covariance, which is often high, across populations. The
latter improves estimation of missing values because populations with
data in one year help inform the values for populations with missing
data that year.</p>
</div>
<div class="section level2">
<h2 id="dynamic-linear-modeling-for-time-varying-trend-estimation">Dynamic linear modeling for time-varying trend estimation<a class="anchor" aria-label="anchor" href="#dynamic-linear-modeling-for-time-varying-trend-estimation"></a>
</h2>
<p>Dynamic linear models (DLMs) are similar to linear regression models
with a yearly trend. Like a classic trend analysis using linear
regression, the goal is to estimate the smoothed spawner count at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
is year (time). Linear regression models, however, use a time-constant
yearly trend while DLMs allow the trend to be time-varying.</p>
<p>A classic linear regression of log spawners
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>)
against year treats the trend
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ≤</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>)
or yearly growth in the smoothed spawner count as a constant and fits
the following model:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="center" style="text-align: center"><msub><mover><mi>y</mi><mo accent="true">‚Äæ</mo></mover><mi>t</mi></msub><mo>=</mo><msub><mover><mi>y</mi><mo accent="true">‚Äæ</mo></mover><mrow><mi>t</mi><mo>‚àí</mo><mn>1</mn></mrow></msub><mo>+</mo><mi>Œ≤</mi></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>y</mi><mi>t</mi></msub><mo>=</mo><msub><mover><mi>y</mi><mo accent="true">‚Äæ</mo></mover><mi>t</mi></msub><mo>+</mo><msub><mi>v</mi><mi>t</mi></msub></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}
\begin{gathered}
\bar{y}_t = \bar{y}_{t-1} + \beta \\
y_t=\bar{y}_t + v_t
\end{gathered}
\end{equation}</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mi>t</mi></msub><annotation encoding="application/x-tex">y_t</annotation></semantics></math>
are the observations,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mover><mi>y</mi><mo accent="true">‚Äæ</mo></mover><mi>t</mi></msub><annotation encoding="application/x-tex">\bar{y}_t</annotation></semantics></math>
is the mean of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mi>t</mi></msub><annotation encoding="application/x-tex">y_t</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>v</mi><mi>t</mi></msub><annotation encoding="application/x-tex">v_t</annotation></semantics></math>
are normal-distributed errors. The smoothed spawner count in year
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
is the smoothed spawner count in year
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>‚àí</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">t-1</annotation></semantics></math>
plus the constant trend value
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ≤</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>.
Normally we write this model in classic linear regression form as
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>t</mi></msub><mo>=</mo><mi>Œ±</mi><mo>+</mo><mi>Œ≤</mi><mi>t</mi><mo>+</mo><msub><mi>v</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\begin{equation}
y_t = \alpha + \beta t + v_t
\end{equation}</annotation></semantics></math> with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>y</mi><mo accent="true">‚Äæ</mo></mover><mi>t</mi></msub><mo>=</mo><mi>Œ±</mi><mo>+</mo><mi>Œ≤</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">\bar{y}_t = \alpha + \beta t</annotation></semantics></math>.
A DLM, in contrast, allows us to fit a model with a time-varying
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ≤</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>.
Specifically, the following model
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="center" style="text-align: center"><msub><mover><mi>y</mi><mo accent="true">‚Äæ</mo></mover><mi>t</mi></msub><mo>=</mo><msub><mover><mi>y</mi><mo accent="true">‚Äæ</mo></mover><mrow><mi>t</mi><mo>‚àí</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>Œ≤</mi><mi>t</mi></msub><mo>=</mo><msub><mover><mi>y</mi><mo accent="true">‚Äæ</mo></mover><mrow><mi>t</mi><mo>‚àí</mo><mn>1</mn></mrow></msub><mo>+</mo><mi>u</mi><mo>+</mo><msub><mi>w</mi><mi>t</mi></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>y</mi><mi>t</mi></msub><mo>=</mo><msub><mover><mi>y</mi><mo accent="true">‚Äæ</mo></mover><mi>t</mi></msub><mo>+</mo><msub><mi>v</mi><mi>t</mi></msub></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}
\begin{gathered}
\bar{y}_t = \bar{y}_{t-1} + \beta_t = \bar{y}_{t-1} + u + w_t \\
y_t=\bar{y}_t + v_t
\end{gathered}
\end{equation}</annotation></semantics></math> The time-varying
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ≤</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ≤</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\beta_t</annotation></semantics></math>,
is modeled as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mo>+</mo><msub><mi>w</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">u+w_t</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>u</mi><annotation encoding="application/x-tex">u</annotation></semantics></math>
is the mean of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ≤</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\beta_t</annotation></semantics></math>
across all
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>w</mi><mi>t</mi></msub><annotation encoding="application/x-tex">w_t</annotation></semantics></math>
is a normally distributed random variable.</p>
<p>Figure 1 shows some example spawner data where a time-varying
sinusoidal
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ≤</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
(yearly growth rate) was used to generate counts (the circles) using
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>y</mi><mo accent="true">‚Äæ</mo></mover><mi>t</mi></msub><mo>=</mo><msub><mover><mi>y</mi><mo accent="true">‚Äæ</mo></mover><mrow><mi>t</mi><mo>‚àí</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>Œ≤</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\bar{y}_t = \bar{y}_{t-1} + \beta_t</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>t</mi></msub><mo>=</mo><mover><msub><mi>y</mi><mi>t</mi></msub><mo accent="true">‚Äæ</mo></mover><mo>+</mo><msub><mi>v</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">y_t=\bar{y_t}+v_t</annotation></semantics></math>.
This model can also be written
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>t</mi></msub><mo>=</mo><mi>Œ±</mi><mo>+</mo><msubsup><mo>‚àë</mo><mn>1</mn><mi>t</mi></msubsup><msub><mi>Œ≤</mi><mi>t</mi></msub><mo>+</mo><msub><mi>e</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">y_t=\alpha+\sum_1^t \beta_t + e_t</annotation></semantics></math>.
The black line in the top panel of Figure 1 shows the true mean
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>.
The red line shows the estimate from a linear regression of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
against year with a non-time-varying
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ≤</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>.
The blue shows the estimate from a DLM where the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ≤</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
is allowed to vary in time. The bottom panel shows the estimate of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ≤</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
compared to the true sinusoidal
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ≤</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
that generated the data. This illustrates the power of DLM when the
objective is to estimate a time-varying trend.</p>
<div class="figure" style="text-align: center">
<img src="Methods_files/figure-html/example1-1.png" class="r-plt" alt="Figure 1. This figure compares a trend analysis using a non-time-varying trend (red) via linear regression versus a trend analysis using a time-varying trend (blue). The black line is the true value and the dots in the top panel are the observations of the black line in the top panel." width="576"><p class="caption">
Figure 1. This figure compares a trend analysis using a non-time-varying
trend (red) via linear regression versus a trend analysis using a
time-varying trend (blue). The black line is the true value and the dots
in the top panel are the observations of the black line in the top
panel.
</p>
</div>
</div>
<div class="section level2">
<h2 id="multivariate-dlms-for-analysis-of-multiple-time-series-from-one-esu">Multivariate DLMs for analysis of multiple time series from one
ESU<a class="anchor" aria-label="anchor" href="#multivariate-dlms-for-analysis-of-multiple-time-series-from-one-esu"></a>
</h2>
<p>A multivariate DLM allows one to estimate time-varying trends using a
set of observed time series, in our case populations within ESU, where
parameter sharing is allowed across the time series. Specifically, one
can constrain the variances to be the same across time series and to
allow covariance across time series. The latter allows information from
time series with data in year
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
to help inform the estimate or the smoothed
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
for time series that have no data in year
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>.</p>
<p>Mathematically, the model being fit is
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="center" style="text-align: center"><msub><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msub><mover><mi>y</mi><mo accent="true">‚Äæ</mo></mover><mn>1</mn></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mover><mi>y</mi><mo accent="true">‚Äæ</mo></mover><mn>2</mn></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mover><mi>y</mi><mo accent="true">‚Äæ</mo></mover><mn>3</mn></msub></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mi>t</mi></msub><mo>=</mo><msub><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msub><mover><mi>y</mi><mo accent="true">‚Äæ</mo></mover><mn>1</mn></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mover><mi>y</mi><mo accent="true">‚Äæ</mo></mover><mn>2</mn></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mover><mi>y</mi><mo accent="true">‚Äæ</mo></mover><mn>3</mn></msub></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mrow><mi>t</mi><mo>‚àí</mo><mn>1</mn></mrow></msub><mo>+</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>u</mi><mn>1</mn></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>u</mi><mn>2</mn></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>u</mi><mn>3</mn></msub></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mo>+</mo><msub><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>w</mi><mn>1</mn></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>w</mi><mn>2</mn></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>w</mi><mn>3</mn></msub></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mi>t</mi></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>y</mi><mn>1</mn></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>y</mi><mn>2</mn></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>y</mi><mn>3</mn></msub></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mi>t</mi></msub><mo>=</mo><msub><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msub><mover><mi>y</mi><mo accent="true">‚Äæ</mo></mover><mn>1</mn></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mover><mi>y</mi><mo accent="true">‚Äæ</mo></mover><mn>2</mn></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mover><mi>y</mi><mo accent="true">‚Äæ</mo></mover><mn>3</mn></msub></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mi>t</mi></msub><mo>+</mo><msub><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>v</mi><mn>1</mn></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>v</mi><mn>2</mn></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>v</mi><mn>3</mn></msub></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mi>t</mi></msub></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}
\begin{gathered}
\begin{bmatrix}\bar{y}_1\\\bar{y}_2\\\bar{y}_3\end{bmatrix}_{t}
=\begin{bmatrix}\bar{y}_1\\\bar{y}_2\\\bar{y}_3\end{bmatrix}_{t-1} + 
\begin{bmatrix}u_1\\ u_2\\ u_3\end{bmatrix}+
\begin{bmatrix}w_1\\ w_2\\ w_3\end{bmatrix}_t \\
\begin{bmatrix}y_1\\ y_2\\ y_3\end{bmatrix}_t
=\begin{bmatrix}\bar{y}_1\\\bar{y}_2\\\bar{y}_3\end{bmatrix}_t + 
\begin{bmatrix}v_1\\ v_2\\ v_3\end{bmatrix}_t
\end{gathered}
\end{equation}</annotation></semantics></math> The
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>u</mi><mi>j</mi></msub><annotation encoding="application/x-tex">u_j</annotation></semantics></math>
are the mean of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ≤</mi><mrow><mi>j</mi><mo>,</mo><mi>t</mi></mrow></msub><annotation encoding="application/x-tex">\beta_{j,t}</annotation></semantics></math>,
so the average long-term trend and the trend at year
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œ≤</mi><mrow><mi>j</mi><mo>,</mo><mi>t</mi></mrow></msub><mo>=</mo><msub><mi>u</mi><mi>j</mi></msub><mo>+</mo><msub><mi>w</mi><mrow><mi>j</mi><mo>,</mo><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\beta_{j,t}=u_j+w_{j,t}</annotation></semantics></math>.
The
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>w</mi><mi>t</mi></msub><annotation encoding="application/x-tex">w_t</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>v</mi><mi>t</mi></msub><annotation encoding="application/x-tex">v_t</annotation></semantics></math>
are error terms drawn from a multivariate normal distribution with
variance-covariance matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùêê</mi><annotation encoding="application/x-tex">\mathbf{Q}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùêë</mi><annotation encoding="application/x-tex">\mathbf{R}</annotation></semantics></math>
respectively. The structure of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùêê</mi><annotation encoding="application/x-tex">\mathbf{Q}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùêë</mi><annotation encoding="application/x-tex">\mathbf{R}</annotation></semantics></math>
allows one to specify different types of parameter constraints (for
example equal variances).</p>
<div class="section level3">
<h3 id="treatment-of-nas-and-0s">Treatment of NAs and 0s<a class="anchor" aria-label="anchor" href="#treatment-of-nas-and-0s"></a>
</h3>
<p>NAs are years with missing spawner counts. The spawner count for
these years will be estimated with the DLM and the estimate will take
into account the spawner counts in that population both before and after
the missing year. The estimate will also take into account the spawner
counts for that year in the other populations and the degree to which
populations within the ESU are temporally correlated.</p>
<p>The modeling uses log-spawners and 0s in the counts will be replaced
with NA (log(0)=NA). This will have minimal effect if 0s are rare, but
if 0s are common, then caution is required since removal of 0s will bias
the estimates upward. For the raw metrics, such raw geomeans, the 0s are
also replaced with NA. Thus when a 0 appears in the 5-year range used
for a geomean calculation, that year is replaced with NA and only the
remaining 4 years are used to compute the geomean, i.e.¬†the reported raw
geomean would be the product of the 4 non-zero counts raised to the 1/4
power.</p>
</div>
<div class="section level3">
<h3 id="model-selection">Model selection<a class="anchor" aria-label="anchor" href="#model-selection"></a>
</h3>
<p>Model selection was used to select the structure of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùêê</mi><annotation encoding="application/x-tex">\mathbf{Q}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùêë</mi><annotation encoding="application/x-tex">\mathbf{R}</annotation></semantics></math>.
The following structures were explored for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùêê</mi><annotation encoding="application/x-tex">\mathbf{Q}</annotation></semantics></math>:
diagonal with unequal variances (no covariance), diagonal with equal
variances, one variance and one covariance across all populations, equal
variances and covariances across similar run timings in a population,
and unconstrained (unique variances and covariances across all
populations). For
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùêë</mi><annotation encoding="application/x-tex">\mathbf{R}</annotation></semantics></math>
the following structures were explored: diagonal with unequal variances
(no covariance) and diagonal with equal variances. The
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùêë</mi><annotation encoding="application/x-tex">\mathbf{R}</annotation></semantics></math>
represents the residual variance, non-time-dependent error and was
assumed not to covary across populations
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùêê</mi><annotation encoding="application/x-tex">\mathbf{Q}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùêë</mi><annotation encoding="application/x-tex">\mathbf{R}</annotation></semantics></math>
cannot both have covariance terms in the DLM due to identifiability
constraints). Across the majority of ESUs, model selection gave the most
data support (quantified with AICc) to a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùêê</mi><annotation encoding="application/x-tex">\mathbf{Q}</annotation></semantics></math>
with one variance and one covariance across all populations in an ESU
and a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùêë</mi><annotation encoding="application/x-tex">\mathbf{R}</annotation></semantics></math>
with one residual variance across populations.</p>
</div>
<div class="section level3">
<h3 id="code-to-fit-a-multivariate-dlm">Code to fit a multivariate DLM<a class="anchor" aria-label="anchor" href="#code-to-fit-a-multivariate-dlm"></a>
</h3>
<p>The <a href="https://cran.r-project.org/package=MARSS" class="external-link">MARSS</a> R
package was used to fit multivariate DLMs to the log-spawner counts (or
indices in some cases). The package handles missing data entered as NAs
for missing years. The following example code shows how to fit two
time-series via a multivariate DLM using the MARSS R package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://atsa-es.github.io/MARSS/" class="external-link">MARSS</a></span><span class="op">)</span></span>
<span><span class="va">logspawners</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span><span class="fl">1106</span>, <span class="fl">1503</span>, <span class="fl">853</span>, <span class="fl">566</span>, <span class="fl">251</span>, <span class="fl">424</span>, <span class="fl">783</span>, <span class="fl">639</span>, <span class="fl">566</span>, <span class="fl">413</span>, <span class="fl">1035</span>, <span class="fl">890</span>,</span>
<span><span class="fl">7348</span>, <span class="fl">6880</span>, <span class="fl">2699</span>, <span class="fl">1096</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="fl">1318</span>, <span class="fl">1127</span>, <span class="fl">472</span>, <span class="fl">637</span>, <span class="fl">869</span></span>
<span><span class="op">)</span>, <span class="fl">2</span>,<span class="fl">12</span>, byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">model</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  Q<span class="op">=</span><span class="st">"equalvarcov"</span>, </span>
<span>  R<span class="op">=</span><span class="st">"diagonal and equal"</span>,</span>
<span>  U<span class="op">=</span><span class="st">"unequal"</span><span class="op">)</span></span>
<span><span class="va">fit</span><span class="op">=</span><span class="fu"><a href="https://atsa-es.github.io/MARSS/reference/MARSS.html" class="external-link">MARSS</a></span><span class="op">(</span><span class="va">logspawners</span>, model<span class="op">=</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="Methods_files/figure-html/fig2-1.png" class="r-plt" alt="Figure 2. The estimated smoothed log-spawners using a multivariate DLM. Notice that the information from the early years when data are available for time-series 1 are used to inform the estimate for time-series 2.  In the ESU reports, these estimates are shown in light grey. Because the model works in log-space, raw spawner counts that are equal to 0 are replaced with NA (log(0)=NA). If there are few 0s in the data, this will only slightly affect the estimates but if there are many 0s in the data, caution is required since removal of 0s will bias the estimates upward." width="576"><p class="caption">
Figure 2. The estimated smoothed log-spawners using a multivariate DLM.
Notice that the information from the early years when data are available
for time-series 1 are used to inform the estimate for time-series 2. In
the ESU reports, these estimates are shown in light grey. Because the
model works in log-space, raw spawner counts that are equal to 0 are
replaced with NA (log(0)=NA). If there are few 0s in the data, this will
only slightly affect the estimates but if there are many 0s in the data,
caution is required since removal of 0s will bias the estimates upward.
</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="wild-spawner-and-fraction-wild-estimates">Wild spawner and fraction wild estimates<a class="anchor" aria-label="anchor" href="#wild-spawner-and-fraction-wild-estimates"></a>
</h2>
<p>For some populations, there were fraction wild estimates. However,
for many populations, these data were noisy and had many missing years.
In addition, the number of years with fraction wild information was
often shorter than the years with total spawner counts. To estimate a
smoothed wild spawner estimate, similar to the smoothed total spawner
estimate, the smoothed total spawner estimate was multiplied a smoothed
estimate of the fraction wild. The smoothed estimate was produced by
fitting a univariate DLM to the logit
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mi>t</mi></msub><mo>=</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>f</mi><mi>/</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>‚àí</mo><mi>f</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">z_t=\log(f/(1-f))</annotation></semantics></math>
of the fraction wild estimates. with a time-varying
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ≤</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>.
Specifically, the following model
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="center" style="text-align: center"><msub><mover><mi>z</mi><mo accent="true">‚Äæ</mo></mover><mi>t</mi></msub><mo>=</mo><msub><mover><mi>z</mi><mo accent="true">‚Äæ</mo></mover><mrow><mi>t</mi><mo>‚àí</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>Œ≤</mi><mi>z</mi></msub><mo>+</mo><msub><mi>w</mi><mi>t</mi></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>z</mi><mi>t</mi></msub><mo>=</mo><msub><mover><mi>z</mi><mo accent="true">‚Äæ</mo></mover><mi>t</mi></msub><mo>+</mo><msub><mi>v</mi><mi>t</mi></msub></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}
\begin{gathered}
\bar{z}_t = \bar{z}_{t-1} + \beta_z + w_t \\
z_t=\bar{z}_t + v_t
\end{gathered}
\end{equation}</annotation></semantics></math> The smoothed wild spawner
estimate at time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
was then
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>y</mi><mo accent="true">‚Äæ</mo></mover><mi>t</mi></msub><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>z</mi><mo accent="true">‚Äæ</mo></mover><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>z</mi><mo accent="true">‚Äæ</mo></mover><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\bar{y}_t\exp(\bar{z}_t)/(\exp(\bar{z}_t)+1)</annotation></semantics></math>.
Each fraction natural origin time series from an ESU was fit
independently (no covariance assumed across populations). The fraction
wild estimates were only extended 1 year before and 1 year after the
last fraction wild data points (the observed data).</p>
</div>
<div class="section level2">
<h2 id="summary-statistics">Summary statistics<a class="anchor" aria-label="anchor" href="#summary-statistics"></a>
</h2>
<p>The following summary statistics were reported for the smoothed total
spawner estimates, the smoothed wild spawner estimates, and the raw
total and wild spawner estimates.</p>
<ul>
<li>
<strong>15 year trends</strong> A linear regression was fit to 15
years of the mean wild spawner estimate and the slope (trend)
reported.</li>
<li>
<strong>5 year geometric means</strong> 5-year geometric means were
computed from the mean wild and total spawner estimates and the raw
total and wild spawner estimates. <strong>Note 1</strong> the mean
estimates have no missing values. The raw estimates may have missing
values. When there were missing values, the geometric mean was computed
from only from the non-missing values. For example, if 3 values were
available,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mn>1</mn></msub><msub><mi>y</mi><mn>2</mn></msub><msub><mi>y</mi><mn>3</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mi>/</mi><mn>3</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">( y_1 y_2 y_3)^(1/3)</annotation></semantics></math>
was reported. <strong>Note 2</strong> 0s in the raw data are replaced
with NA thus the raw geomean is the geomean only from the non-zero
counts.</li>
<li>
<strong>average fraction wild</strong> These were computed from the
raw fraction wild estimates. Os in the raw data were left in (not
removed). NAs were treated as NAs (did not affect the estimate).</li>
<li>
<strong>productivity metric</strong> Because age of return data was
not consistent nor available across ESUs and populations, a generic
productivity metric was computed as the mean wild spawner estimate at
year
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
divided by the mean total spawner estimate at year
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>‚àí</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">t-3</annotation></semantics></math>
for Coho and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>‚àí</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">t-4</annotation></semantics></math>
for all other species.</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Holmes Elizabeth.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
